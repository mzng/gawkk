<% news_item					= nil		if news_item.nil? -%>
<% visible_title 			= true	if visible_title.nil? -%>
<% refresh_thumbnail	= false if refresh_thumbnail.nil? -%>
<% load_activity			= false	if load_activity.nil? -%>
<% load_comments			= false	if load_comments.nil? -%>

<% container_id ||= (news_item.nil? ? '' : "_#{news_item.id}") -%>
<div id="video_<%= video.id %><%= container_id %>" class="video">
	<table class="anchored_container" cellpadding="0" cellspacing="0">
		<tr>
			<% if !news_item.nil? -%>
				<td class="action_owner" rowspan="2">
					<span style="height:50px;overflow:hidden;width:50px;">
						<%= link_to image_tag(news_item.user.thumbnail.blank? ? 'profile-pic.jpg' : news_item.user.thumbnail, :class => 'avatar'), user_path(:id => news_item.user) %>
						<img src="http://web1.tunnlr.com:10581/images/fb-avatar-large-rounded-corner-overlay.png" style="display:block;left:0px;overflow:hidden;position:relative;top:-52px;"/>
					</span>
				</td>
				<td class="action_description">
					<%= news_item.render_simple %>
				</td>
			<% elsif !video.posted_by.nil? -%>
				<td class="action_owner" rowspan="2">
					<span style="height:50px;overflow:hidden;width:50px;">
						<%= link_to image_tag(video.posted_by.thumbnail.blank? ? 'profile-pic.jpg' : video.posted_by.thumbnail, :class => 'avatar'), user_path(:id => video.posted_by) %>
						<img src="http://web1.tunnlr.com:10581/images/fb-avatar-large-rounded-corner-overlay.png" style="display:block;left:0px;overflow:hidden;position:relative;top:-52px;"/>
					</span>
				</td>
				<td class="action_description">
					<%= link_to video.posted_by.username, user_path(:id => video.posted_by) %> posted this video
				</td>
			<% else -%>
				<td class="action_owner" rowspan="2"></td>
				<td class="action_description"></td>
			<% end -%>
		</tr>
		<tr>
			<td class="action_body">
				<div class="title">
					<%= link_to_function video.title, "$('embed_for_#{video.id}#{container_id}').setInnerFBML(embed_code_for_#{video.id}#{container_id});$('embed_for_#{video.id}#{container_id}').show();" %>
					<%= popular_icon(video, container_id) %>
				</div>
				<div class="body">
					<div class="thumbnail">
						<%= link_to_function image_tag(video.thumbnail.blank? ? 'no-image.png' : video.thumbnail), "$('embed_for_#{video.id}#{container_id}').setInnerFBML(embed_code_for_#{video.id}#{container_id});$('embed_for_#{video.id}#{container_id}').show();" %>
					</div>
					<div class="description">
						<span class="first-channel"><%= link_to(video.first_channel.name, channel_path(:user => video.first_channel.user, :channel => video.first_channel)) + ' -' if video.first_channel %></span>
						<% if video.safe_description.length > 160 -%>
							<span id="short_description_for_<%= video.id %><%= container_id %>">
								<%= video.safe_description.first(160) %>... <%= link_to 'read more', '#', :onclick => "read('#{video.id}','#{video.slug}', '#{container_id}');" %>
							</span>
						<% end -%>
						<span id="full_description_for_<%= video.id %><%= container_id %>" <% if video.safe_description.length > 160 -%>style="display:none;"<% end -%>>
							<%= video.safe_description %>
						</span>
					</div>
					<div class="posted">
						Posted in <%= link_to video.cached_category.name, {:controller => 'videos', :action => 'category', :category => video.cached_category, :popular => video.popular?} %>
						<% if !video.url.match(/^\[FROM_EMBED_CODE\]/) -%>
							via <%= link_to video.host, video.url, :target => video.slug %>
						<% end -%>
					</div>
				</div>
			</td>
		</tr>
		<tr>
			<td>&nbsp;</td>
			<td class="actions">
				<% if !news_item.nil? -%>
					<span><%= time_ago_in_words(news_item.created_at) %> ago</span>
				<% elsif !video.posted_by.nil? -%>
					<span><%= time_ago_in_words(video.posted_at) %> ago</span>
				<% end -%>
				&middot; <%= link_to 'Comment', '#' %>
				&middot; <%= link_to 'Like', '#' %>
				&middot; <%= link_to 'Share', '#' %>
			</td>
		</tr>
	</table>
	<div id="embed_for_<%= video.id %><%= container_id %>" class="embed" style="display:none;"></div>
	<fb:js-string var="embed_code_for_<%= video.id %><%= container_id %>">
		<% if !video.embed_code.blank? -%>
			<fb:iframe name="embed_container_for_<%= video.id %><%= container_id %>" src="http://web1.tunnlr.com:10581/<%= video.slug %>/watch?format=fbml" frameborder="0" scrolling="no" resizeable="true" width="100%"></fb:iframe>
		<% else -%>
			<fb:iframe name="embed_container_for_<%= video.id %><%= container_id %>" src="http://web1.tunnlr.com:10581/<%= video.slug %>/watch?format=fbml" frameborder="0" scrolling="no" resizeable="true" width="100%"></fb:iframe>
		<% end -%>
	</fb:js-string>
</div>